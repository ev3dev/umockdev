From 322224c6c434a54c4e763f230363797606760d21 Mon Sep 17 00:00:00 2001
From: Martin Pitt <martinpitt@gnome.org>
Date: Fri, 11 Oct 2013 12:57:55 +0200
Subject: [PATCH] Skip umockdev-record loop device test if /sys exists, but
 there is no loop device

Fixes FTBFS on Debian buildds.
---
 NEWS                            | 5 +++++
 tests/test-umockdev-record.vala | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/NEWS b/NEWS
index d04f6fb..13ca498 100644
--- a/NEWS
+++ b/NEWS
@@ -1,3 +1,8 @@
+0.4.7 (UNRELEASED)
+------------------
+- Skip umockdev-record loop device test if /sys exists, but there is no loop
+  device.
+
 0.4.6 (2013-10-11)
 ------------------
 - Fix wrong select() call timeout which caused a failure on arm64.
diff --git a/tests/test-umockdev-record.vala b/tests/test-umockdev-record.vala
index 4830cd7..68366c7 100644
--- a/tests/test-umockdev-record.vala
+++ b/tests/test-umockdev-record.vala
@@ -182,6 +182,10 @@ t_system_single ()
         stderr.printf ("[SKIP: no real /sys on this system] ");
         return;
     }
+    if (!FileUtils.test("/sys/block/loop0", FileTest.EXISTS)) {
+        stderr.printf ("[SKIP: no /sys/block/loop0 on this system] ");
+        return;
+    }
 
     spawn (umockdev_record_path + " /dev/null /dev/loop0", out sout, out serr, out exit);
     assert_cmpstr (serr, Op.EQ, "");
-- 
1.8.3.2

