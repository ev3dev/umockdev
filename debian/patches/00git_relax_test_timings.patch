From 3ed2f47fa953eb9d1b30953260f7e54990128b8a Mon Sep 17 00:00:00 2001
From: Martin Pitt <martinpitt@gnome.org>
Date: Sat, 12 Oct 2013 19:19:17 +0200
Subject: [PATCH] Slightly relax timings in
 /umockdev-testbed/script_replay_simple test

This should make failure on slow machines less likely. Failure observed on
Debian sparc build.
---
 NEWS                  | 2 ++
 tests/test-umockdev.c | 4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/NEWS b/NEWS
index 13ca498..20d65e6 100644
--- a/NEWS
+++ b/NEWS
@@ -2,6 +2,8 @@
 ------------------
 - Skip umockdev-record loop device test if /sys exists, but there is no loop
   device.
+- Slightly relax timings in /umockdev-testbed/script_replay_simple test to
+  avoid failure on slow machines.
 
 0.4.6 (2013-10-11)
 ------------------
diff --git a/tests/test-umockdev.c b/tests/test-umockdev.c
index dead80f..5270004 100644
--- a/tests/test-umockdev.c
+++ b/tests/test-umockdev.c
@@ -1102,11 +1102,11 @@ r 0 ^@^^^`^@a\n";
 
   /* now we should get the response after 10 ms */
   ASSERT_EOF;
-  usleep(15000);
+  usleep(20000);
   g_assert_cmpint(read(fd, buf, 11), ==, 11);
   g_assert(strncmp(buf, "response\t1\n", 11) == 0);
   g_assert_cmpint(errno, ==, 0);
-  usleep(2000);
+  usleep(5000);
   g_assert_cmpint(read(fd, buf, 15), ==, 15);
   g_assert(strncmp(buf, "hello world â˜º\n", 15) == 0);
   g_assert_cmpint(errno, ==, 0);
-- 
1.8.3.2

